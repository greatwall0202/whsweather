<!-- 以下の修正を加えました：
 1. 日付の横に英語の曜日を追加
 2. 曜日に応じて色を変更（Sun: 赤, Sat: 青, 平日: 白）
 3. 住所をGoogleマップのリンクに変更
-->

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>My Costco Weather</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background-color: #0d1117; color: #ffffff; font-family: "Fira Code", monospace; }
    h1 { text-align: center; color: #00ffff; padding-top: 1rem; }
    .location { font-weight: bold; font-size: 1.1rem; color: #00ffff; }
    table { width: 100%; font-size: 0.85rem; border-collapse: collapse; }
    th, td { padding: 0.4rem; text-align: center; }
    .sun { color: #ff5c5c; }
    .sat { color: #5cbaff; }
    .weekday { color: #ffffff; }
    img.icon { width: 28px; height: 28px; }
  </style>
</head>
<body>
  <h1>My Costco Weather</h1>
  <div id="container"></div>
  <script>
    const apiKey = "1a9e7d04d69124aa1b670a87a74a57de"; // 元のAPIキー
    const allStores = [
      { name: "札幌", lat: 43.0747, lon: 141.3419, address: "北海道札幌市清田区清田1条1丁目1-5" },
      { name: "石狩", lat: 43.1992, lon: 141.3214, address: "北海道石狩市新港南2丁目733-1" },
      { name: "かみのやま", lat: 38.1532, lon: 140.3225, address: "山形県上山市みはらしの丘21番" },
      { name: "仙台", lat: 38.2533, lon: 140.8828, address: "宮城県仙台市宮城野区中野三丁目2-2" },
      { name: "つくば", lat: 36.0576, lon: 140.1186, address: "茨城県つくば市学園の森2-19" },
      { name: "前橋", lat: 36.3842, lon: 139.0633, address: "群馬県前橋市鶴光路町137-2" },
      { name: "群馬明和", lat: 36.2333, lon: 139.4833, address: "群馬県邑楽郡明和町矢島35-1" },
      { name: "壬生", lat: 36.4167, lon: 139.8167, address: "栃木県下都賀郡壬生町安塚3360" },
      { name: "入間", lat: 35.8353, lon: 139.3936, address: "埼玉県入間市宮寺3169-2" },
      { name: "新三郷", lat: 35.8845, lon: 139.8712, address: "埼玉県三郷市新三郷ららシティ3-1-2" },
      { name: "幕張", lat: 35.6598, lon: 140.0433, address: "千葉県千葉市美浜区豊砂1-4" },
      { name: "千葉ニュータウン", lat: 35.8058, lon: 140.0986, address: "千葉県印西市泉野3-1186-4" },
      { name: "金沢シーサイド", lat: 35.3701, lon: 139.6247, address: "神奈川県横浜市金沢区幸浦2-6" },
      { name: "川崎", lat: 35.5403, lon: 139.7037, address: "神奈川県川崎市川崎区池上新町3-1-4" },
      { name: "多摩境", lat: 35.6066, lon: 139.3574, address: "東京都町田市小山ヶ丘3-6-1" },
      { name: "座間", lat: 35.4827, lon: 139.4243, address: "神奈川県座間市東原1-13-3" },
      { name: "浜松", lat: 34.7692, lon: 137.7045, address: "静岡県浜松市東区上西町1020-28" },
      { name: "岐阜羽島", lat: 35.3167, lon: 136.7206, address: "岐阜県羽島市上中町長間2422-1" },
      { name: "守山", lat: 35.2151, lon: 136.9756, address: "愛知県名古屋市守山区下志段味南荒田3032-1" },
      { name: "中部空港", lat: 34.8583, lon: 136.8050, address: "愛知県常滑市りんくう町1-25-14" },
      { name: "京都八幡", lat: 34.8905, lon: 135.6870, address: "京都府八幡市欽明台北5番地" },
      { name: "和泉", lat: 34.4805, lon: 135.4223, address: "大阪府和泉市あゆみ野4-4-45" },
      { name: "門真", lat: 34.7386, lon: 135.5861, address: "大阪府門真市松生町1-1" },
      { name: "尼崎", lat: 34.7327, lon: 135.4084, address: "兵庫県尼崎市次屋3-13-55" },
      { name: "神戸", lat: 34.6938, lon: 135.1955, address: "兵庫県神戸市垂水区多聞町小束山868-26" },
      { name: "広島", lat: 34.3963, lon: 132.4596, address: "広島県広島市南区南蟹屋2-3-4" },
      { name: "南アルプス", lat: 35.6125, lon: 138.4658, address: "山梨県南アルプス市在家塚字中割384" },
      { name: "久山", lat: 33.6522, lon: 130.4869, address: "福岡県糟屋郡久山町大字山田字高柳1152-1" },
      { name: "北九州", lat: 33.8508, lon: 130.7771, address: "福岡県北九州市八幡西区本城学研台1-2-12" },
      { name: "小郡", lat: 33.3864, lon: 130.5656, address: "福岡県小郡市上岩田字吉田764-1" },
      { name: "熊本御船", lat: 32.7294, lon: 130.7802, address: "熊本県上益城郡御船町大字小坂字宮田689-1" },
      { name: "沖縄南城", lat: 26.1475, lon: 127.7555, address: "沖縄県南城市大里字高平高宮城原97-2" }
    ];

    function getWeekdayName(dateStr) {
      const date = new Date(dateStr);
      const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
      return days[date.getDay()];
    }

    function getDayClass(day) {
      if (day === "Sun") return "sun";
      if (day === "Sat") return "sat";
      return "weekday";
    }

    function renderStores(stores) {
      const container = document.getElementById("container");
      container.innerHTML = "";
      stores.forEach(store => {
        const card = document.createElement("div");
        const gmap = `https://www.google.com/maps/search/?q=${encodeURIComponent(store.address)}`;
        card.innerHTML = `
          <div class="location">Costco ${store.name}</div>
          <div><a href="${gmap}" target="_blank" style="color:#00ffff">${store.address}</a></div>
          <table><thead><tr><th>日付 / 曜日</th><th>天気</th><th>最高/最低 (°C)</th></tr></thead><tbody></tbody></table>
          <canvas></canvas>`;
        container.appendChild(card);
        getWeather(store, card);
      });
    }

    async function getWeather(store, card) {
      const url = `https://api.openweathermap.org/data/2.5/forecast?lat=${store.lat}&lon=${store.lon}&units=metric&lang=ja&appid=${apiKey}`;
      const data = await fetch(url).then(r => r.json());
      const dailyMap = {};
      data.list.forEach(entry => {
        const date = entry.dt_txt.split(" ")[0];
        if (!dailyMap[date]) dailyMap[date] = [];
        dailyMap[date].push(entry);
      });

      const dates = Object.keys(dailyMap).slice(0, 5);
      const tbody = card.querySelector("tbody");

      dates.forEach(date => {
        const entries = dailyMap[date];
        const temps = entries.map(e => e.main.temp);
        const max = Math.max(...temps).toFixed(1);
        const min = Math.min(...temps).toFixed(1);
        const icon = entries[0].weather[0].icon;
        const desc = entries[0].weather[0].description;
        const day = getWeekdayName(date);
        const dayClass = getDayClass(day);

        tbody.insertAdjacentHTML("beforeend", `
          <tr>
            <td class="${dayClass}">${date} (${day})</td>
            <td><img class="icon" src="https://openweathermap.org/img/wn/${icon}.png" alt="${desc}" title="${desc}" /></td>
            <td>${max} / ${min}</td>
          </tr>`);
      });
    }

    renderStores(allStores);
  </script>
</body>
</html>
